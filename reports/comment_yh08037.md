# 김도훈's comment

## 좋았던 점

### 1. 팀원과의 협업 및 분업

프로젝트 기획서를 작성하는 과정에서 텀 프로젝트 기간동안 누가 언제 어떤 작업을 할 지 계획하였습니다.
윤대헌 학생은 멀티쓰레딩과 디바이스 드라이버를 활용한 게임 개발에 집중하였고, 저는 멀티 쓰레딩과 소켓 통신을 활용한 서버-클라이언트 로직 개발에 집중하였습니다. 각자 맡은 역할을 중심으로 코드 작업을 진행하는 동시에, 난관에 봉착했을 때는 서로 도와주면서 원활하고 효율적인 프로젝트 진행 가능했습니다.

또한, 프로젝트 전반에 git을 통해 코드를 관리하여 버전 관리와 코드 동기화에 수월했습니다. 특히 본 프로젝트는 Sense HAT이 부착된 라즈베리파이4 2기와 개인적으로 구비한 Ubuntu server 라즈베리파이4 1기, 총 3기의 라즈베리파이로 구성되어 이들의 빈번한 코드 동기화가 필수적이었습니다. 

### 2. 계획 및 실천

서버-클라이언트 통신과 웹을 구현하기 위해서 미리 개발 단계를 계획해놓고, 
계획을 따라 한 단계씩 만들어나가는 방식을 통해 개발이 순조롭게 진행 가능했습니다.
역할을 분담한 뒤 제가 구상하고 실천한 계획은 다음과 같습니다.

1. 강의 자료에 있는 Improved multiple client/server 만들어보기
2. 문자 하나 대신 문자열을 송수신하도록 변경하기
3. 단방향 통신 구조를 양방향 통신이 가능하도록 변경하기
4. brainwars 게임 상태 천이 규칙 처리 로직 구현하기
5. 문자열 대신 메시지 구조체를 송수신하도록 변경하기
6. 윤대헌 학생이 개발한 게임들을 로직에 통합하기
7. 웹 서버를 로직에 통합하기

저와 윤대헌 학생 모두 각 단계를 진행하면서 코드의 양이 늘어나면 여러개의 파일로 분리하고, 함수의 단위로 모듈화하여 중복되는 코드의 양을 최소화하고자 하였습니다. 이를 통해 main함수와 server, client의 메인 코드가 읽기 쉬워졌고, 윤대헌 학생이 작성한 게임을 한두번의 함수 호출만으로 클라이언트 로직에 통합할 수 있었습니다. 이는 개발 과정에서 지속적으로 소통하면서 코드의 인터페이스를 서로에게 맞추어 나갔기 때문에 가능했습니다.

<br>

## 어려웠던 점

### 1. 웹 서버 
멀티 프로세싱 데이터 전달 문제

오픈 소스로 공개된 코드를 활용하여 웹 서버를 구현하였는데,

이 코드의 동작 방식을 자세히 이해하지 않은 채로 사용하다가 문제가 생김

게임 로직 쓰레드와 웹 서버 쓰레드가 game이라는 한 전역변수를 참조하는데, 

게임 로직 쓰레드에서는 읽기만 하고 웹 서버 쓰레드에서 읽고 쓰기를 함

그래서 하나 전역 변수를 공유하는 것에는 문제가 없을 것이라고 판단했었음

하지만, 웹 브라우저에서 버튼 입력으로 게임을 선택할 때, 선택한 게임의 고유번호를 game에 저장하는데,

게임 로직 쓰레드에서 저장된 값이 적용이 되지 않는 문제가 발생함

각각의 쓰레드에서 game 변수의 포인터 주소도 확인해보았지만 똑같았고,

값 쓰기가 되지 않는 원인을 찾아내는데 상당히 긴 시간이 소요됨

원인은 웹 서버가 동작하는 방식에 있었음

웹 서버는 브라우저로 부터 request가 오면 해당 request를 처리하기 위해서 

새로운 child process를 fork()를 통해 생성함

이를 통해 기존의 parent process는 다른 request를 계속 처리할 수 있음

문제는 child process에서 


### 2. 게임 서버 
멀티 클라이언트 관리 로직 일반화

<br>

## 아쉬운 점

### 1. 부족했던 웹에 대한 지식
두번 클릭 / 서버 동기화해서 자동 페이지 넘김 미구현 / post 사용 못함

동적인 웹 구현 못함 -> html을 그때그때 문자열로 생성해서 보냄

### 2. 게임 서버 문제
일부분은 두명의 유저만을 고려하여 만들어진 채로 남아있음